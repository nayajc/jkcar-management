<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JKCar Management - ëŒ€ì‹œë³´ë“œ</title>
  <?!= include('styles'); ?>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="header-content">
        <a href="?page=home" class="logo">
          ğŸš— JKCar Management
        </a>
        <nav class="nav">
          <a href="dashboard.html" class="nav-link active">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
          <a href="vehicles.html" class="nav-link">ğŸš— ì°¨ëŸ‰ê´€ë¦¬</a>
          <a href="accidents.html" class="nav-link">ğŸ“ ì‚¬ê³ ê´€ë¦¬</a>
          <a href="maintenance.html" class="nav-link">ğŸ”§ ì •ë¹„ê´€ë¦¬</a>
          <a href="profile.html" class="nav-link">ğŸ‘¤ í”„ë¡œí•„</a>
        </nav>
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()">â˜°</button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main">
    <div class="container">
      <!-- Welcome Section -->
      <section class="welcome-section mb-6">
        <div class="card">
          <div class="welcome-content">
            <div class="welcome-text">
              <h1>ì•ˆë…•í•˜ì„¸ìš”, <span class="user-nickname">ì‚¬ìš©ì</span>ë‹˜! ğŸ‘‹</h1>
              <p>ì˜¤ëŠ˜ë„ ì•ˆì „í•œ ìš´ì „ ë˜ì„¸ìš”. ì°¨ëŸ‰ ê´€ë¦¬ í˜„í™©ì„ í™•ì¸í•´ë³´ì„¸ìš”.</p>
            </div>
            <div class="welcome-actions">
              <button class="btn btn-primary" onclick="showAddVehicleModal()">
                ğŸš— ìƒˆ ì°¨ëŸ‰ ë“±ë¡
              </button>
              <button class="btn btn-secondary" onclick="window.location.href='?page=accidents'">
                ğŸ“ ì‚¬ê³  ê¸°ë¡
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Stats Section -->
      <section class="stats-section mb-6">
        <h2 class="section-title">ğŸ“Š ì°¨ëŸ‰ í˜„í™©</h2>
        <div id="dashboard-stats" class="grid grid-4">
          <div class="stats-card">
            <div class="stats-number">0</div>
            <div class="stats-label">ë“±ë¡ëœ ì°¨ëŸ‰</div>
          </div>
          <div class="stats-card">
            <div class="stats-number">0</div>
            <div class="stats-label">ë§Œë£Œ ì˜ˆì •</div>
          </div>
          <div class="stats-card">
            <div class="stats-number">0</div>
            <div class="stats-label">ì‚¬ê³  ê¸°ë¡</div>
          </div>
          <div class="stats-card">
            <div class="stats-number">0</div>
            <div class="stats-label">ì •ë¹„ ê¸°ë¡</div>
          </div>
        </div>
      </section>

      <!-- Quick Actions -->
      <section class="quick-actions mb-6">
        <h2 class="section-title">âš¡ ë¹ ë¥¸ ì‘ì—…</h2>
        <div class="grid grid-4">
          <div class="quick-action-card card text-center">
            <div class="quick-action-icon">ğŸš—</div>
            <h3>ì°¨ëŸ‰ ë“±ë¡</h3>
            <p>ìƒˆ ì°¨ëŸ‰ì„ ë“±ë¡í•˜ì„¸ìš”</p>
            <button class="btn btn-primary btn-sm" onclick="showAddVehicleModal()">
              ë“±ë¡í•˜ê¸°
            </button>
          </div>
          <div class="quick-action-card card text-center">
            <div class="quick-action-icon">ğŸ“</div>
            <h3>ì‚¬ê³  ê¸°ë¡</h3>
            <p>ì‚¬ê³  ì •ë³´ë¥¼ ê¸°ë¡í•˜ì„¸ìš”</p>
            <button class="btn btn-warning btn-sm" onclick="showAddAccidentModal()">
              ê¸°ë¡í•˜ê¸°
            </button>
          </div>
          <div class="quick-action-card card text-center">
            <div class="quick-action-icon">ğŸ”§</div>
            <h3>ì •ë¹„ ê¸°ë¡</h3>
            <p>ì •ë¹„ ë‚´ì—­ì„ ê¸°ë¡í•˜ì„¸ìš”</p>
            <button class="btn btn-success btn-sm" onclick="showAddMaintenanceModal()">
              ê¸°ë¡í•˜ê¸°
            </button>
          </div>
          <div class="quick-action-card card text-center">
            <div class="quick-action-icon">ğŸ“…</div>
            <h3>ì¼ì • í™•ì¸</h3>
            <p>ë§Œë£Œì¼ì„ í™•ì¸í•˜ì„¸ìš”</p>
            <button class="btn btn-secondary btn-sm" onclick="checkExpiryDates()">
              í™•ì¸í•˜ê¸°
            </button>
          </div>
        </div>
      </section>

      <!-- Recent Vehicles -->
      <section class="recent-vehicles mb-6">
        <div class="card-header">
          <h2 class="section-title">ğŸš— ìµœê·¼ ë“±ë¡ëœ ì°¨ëŸ‰</h2>
          <a href="?page=vehicles" class="btn btn-secondary">ì „ì²´ ë³´ê¸°</a>
        </div>
        <div id="recent-vehicles-container" class="grid grid-3">
          <!-- ì°¨ëŸ‰ ëª©ë¡ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
        </div>
      </section>

      <!-- Expiring Soon -->
      <section class="expiring-soon mb-6">
        <h2 class="section-title">âš ï¸ ë§Œë£Œ ì˜ˆì •</h2>
        <div id="expiring-soon-container">
          <!-- ë§Œë£Œ ì˜ˆì • í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
        </div>
      </section>

      <!-- Recent Activities -->
      <section class="recent-activities mb-6">
        <h2 class="section-title">ğŸ“‹ ìµœê·¼ í™œë™</h2>
        <div class="card">
          <div id="activities-container">
            <!-- í™œë™ ë‚´ì—­ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p>&copy; 2024 JKCar Management. All rights reserved.</p>
    </div>
  </footer>

  <?!= include('script'); ?>

  <script>
  // ëŒ€ì‹œë³´ë“œ ì „ìš© í•¨ìˆ˜ë“¤
  function loadDashboardData() {
    loadVehicles();
    loadRecentActivities();
    checkExpiryDates();
  }

  // ìµœê·¼ í™œë™ ë¡œë“œ
  function loadRecentActivities() {
    // ì‹¤ì œë¡œëŠ” Firebaseì—ì„œ í™œë™ ë‚´ì—­ì„ ê°€ì ¸ì˜´
    const activities = [
      { type: 'vehicle', action: 'ì°¨ëŸ‰ ë“±ë¡', description: 'Toyota Camry (ABC-123) ë“±ë¡', time: '2ì‹œê°„ ì „' },
      { type: 'maintenance', action: 'ì •ë¹„ ì™„ë£Œ', description: 'ì˜¤ì¼ êµí™˜ ì™„ë£Œ', time: '1ì¼ ì „' },
      { type: 'accident', action: 'ì‚¬ê³  ê¸°ë¡', description: 'ê²½ë¯¸í•œ ì ‘ì´‰ì‚¬ê³  ê¸°ë¡', time: '3ì¼ ì „' }
    ];

    const container = document.getElementById('activities-container');
    if (container) {
      container.innerHTML = activities.map(activity => `
        <div class="activity-item">
          <div class="activity-icon">
            ${activity.type === 'vehicle' ? 'ğŸš—' : activity.type === 'maintenance' ? 'ğŸ”§' : 'ğŸ“'}
          </div>
          <div class="activity-content">
            <div class="activity-title">${activity.action}</div>
            <div class="activity-description">${activity.description}</div>
            <div class="activity-time">${activity.time}</div>
          </div>
        </div>
      `).join('');
    }
  }

  // ë§Œë£Œ ì˜ˆì • í•­ëª© í‘œì‹œ
  function showExpiringItems() {
    const expiringItems = vehicles.filter(vehicle => {
      const today = new Date();
      const regoExpiry = vehicle.regoExpiry ? new Date(vehicle.regoExpiry) : null;
      const insuranceExpiry = vehicle.insuranceExpiry ? new Date(vehicle.insuranceExpiry) : null;
      const greenSlipExpiry = vehicle.greenSlipExpiry ? new Date(vehicle.greenSlipExpiry) : null;
      
      return (regoExpiry && regoExpiry - today <= 30 * 24 * 60 * 60 * 1000) ||
             (insuranceExpiry && insuranceExpiry - today <= 30 * 24 * 60 * 60 * 1000) ||
             (greenSlipExpiry && greenSlipExpiry - today <= 30 * 24 * 60 * 60 * 1000);
    });

    const container = document.getElementById('expiring-soon-container');
    if (container) {
      if (expiringItems.length === 0) {
        container.innerHTML = `
          <div class="card text-center">
            <div class="mb-4">âœ…</div>
            <h3>ë§Œë£Œ ì˜ˆì •ì¸ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤</h3>
            <p class="text-gray-600">ëª¨ë“  ë“±ë¡ì¦ê³¼ ë³´í—˜ì´ ì •ìƒì…ë‹ˆë‹¤!</p>
          </div>
        `;
      } else {
        container.innerHTML = expiringItems.map(vehicle => {
          const expiringItems = [];
          const today = new Date();
          
          if (vehicle.regoExpiry) {
            const regoDate = new Date(vehicle.regoExpiry);
            const daysUntilExpiry = Math.ceil((regoDate - today) / (1000 * 60 * 60 * 24));
            if (daysUntilExpiry <= 30) {
              expiringItems.push({ type: 'Rego', days: daysUntilExpiry, date: vehicle.regoExpiry });
            }
          }
          
          if (vehicle.insuranceExpiry) {
            const insuranceDate = new Date(vehicle.insuranceExpiry);
            const daysUntilExpiry = Math.ceil((insuranceDate - today) / (1000 * 60 * 60 * 24));
            if (daysUntilExpiry <= 30) {
              expiringItems.push({ type: 'ë³´í—˜', days: daysUntilExpiry, date: vehicle.insuranceExpiry });
            }
          }
          
          if (vehicle.greenSlipExpiry) {
            const greenSlipDate = new Date(vehicle.greenSlipExpiry);
            const daysUntilExpiry = Math.ceil((greenSlipDate - today) / (1000 * 60 * 60 * 24));
            if (daysUntilExpiry <= 30) {
              expiringItems.push({ type: 'Green Slip', days: daysUntilExpiry, date: vehicle.greenSlipExpiry });
            }
          }

          return expiringItems.map(item => `
            <div class="card mb-3">
              <div class="expiring-item">
                <div class="expiring-icon">âš ï¸</div>
                <div class="expiring-content">
                  <div class="expiring-title">${vehicle.plateNumber} - ${item.type}</div>
                  <div class="expiring-description">
                    ${item.days <= 0 ? 'ì˜¤ëŠ˜ ë§Œë£Œ' : `${item.days}ì¼ í›„ ë§Œë£Œ`} (${formatDate(item.date)})
                  </div>
                </div>
                <div class="expiring-action">
                  <button class="btn btn-warning btn-sm" onclick="remindLater('${vehicle.id}', '${item.type}')">
                    ë‚˜ì¤‘ì— ì•Œë¦¼
                  </button>
                </div>
              </div>
            </div>
          `).join('');
        }).join('');
      }
    }
  }

  // ë‚˜ì¤‘ì— ì•Œë¦¼
  function remindLater(vehicleId, itemType) {
    showAlert(`${itemType} ë§Œë£Œ ì•Œë¦¼ì„ 7ì¼ í›„ë¡œ ì—°ê¸°í–ˆìŠµë‹ˆë‹¤.`, 'info');
  }

  // ì‚¬ê³  ê¸°ë¡ ëª¨ë‹¬ í‘œì‹œ
  function showAddAccidentModal() {
    window.location.href = '?page=accidents';
  }

  // ì •ë¹„ ê¸°ë¡ ëª¨ë‹¬ í‘œì‹œ
  function showAddMaintenanceModal() {
    window.location.href = '?page=maintenance';
  }

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
  document.addEventListener('DOMContentLoaded', function() {
    loadDashboardData();
  });
  </script>

  <style>
  /* Welcome Section */
  .welcome-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 2rem;
  }

  .welcome-text h1 {
    font-size: 2rem;
    font-weight: 700;
    color: var(--gray-800);
    margin-bottom: 0.5rem;
  }

  .welcome-text p {
    color: var(--gray-600);
    font-size: 1.1rem;
  }

  .welcome-actions {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  /* Quick Action Cards */
  .quick-action-card {
    padding: 2rem 1.5rem;
  }

  .quick-action-icon {
    font-size: 2.5rem;
    margin-bottom: 1rem;
  }

  .quick-action-card h3 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--gray-800);
  }

  .quick-action-card p {
    color: var(--gray-600);
    margin-bottom: 1rem;
    font-size: 0.875rem;
  }

  /* Activity Items */
  .activity-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 0;
    border-bottom: 1px solid var(--gray-200);
  }

  .activity-item:last-child {
    border-bottom: none;
  }

  .activity-icon {
    font-size: 1.5rem;
    width: 40px;
    height: 40px;
    background: var(--light-blue);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .activity-content {
    flex: 1;
  }

  .activity-title {
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: 0.25rem;
  }

  .activity-description {
    color: var(--gray-600);
    font-size: 0.875rem;
    margin-bottom: 0.25rem;
  }

  .activity-time {
    color: var(--gray-400);
    font-size: 0.75rem;
  }

  /* Expiring Items */
  .expiring-item {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .expiring-icon {
    font-size: 1.5rem;
  }

  .expiring-content {
    flex: 1;
  }

  .expiring-title {
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: 0.25rem;
  }

  .expiring-description {
    color: var(--gray-600);
    font-size: 0.875rem;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .welcome-content {
      flex-direction: column;
      text-align: center;
    }

    .welcome-actions {
      justify-content: center;
    }

    .quick-action-card {
      padding: 1.5rem 1rem;
    }

    .expiring-item {
      flex-direction: column;
      text-align: center;
      gap: 0.5rem;
    }
  }
  </style>
</body>
</html> 